---
title: "p8105_hw2_al3851.Rmd"
output: github_document
---

```{r packages}

library(tidyverse)
library(p8105.datasets)

```

#Problem 1

##Initial Cleaning


```{r}

station_df = read_csv("./Data/NYC_Transit_Subway_Entrance_And_Exit_Data.csv") %>%
  janitor::clean_names() %>%
  select(line:entry, vending, ada) %>%
  mutate(vending = recode(vending, "YES" = TRUE, "NO" = FALSE)) %>%
  mutate(entry = recode(entry, "YES" = TRUE, "NO" = FALSE))


```

The data is still not tidy because the train line and route number are arranged in the wide format, since each route number is a variable name. However, after cleaning the names of the columns I selected only the needed columns, and within the mutate function, I used recode so that the "YES" "NO" charcter values of vending and entry would now be the logical TRUE FALSE. The data set has `r nrow(station_df)` rows which represent each entrance or exit to every station in NYC and the dataset has `r ncol(station_df)` variables which are `colnames(station_df)`. 


##ADA Compliance 

I am using distinct with the parameter .keep_all = TRUE to get a dataframe with just one row from each station.
The number of rows will tell me the number of stations. The sum of the ada variable over the number of rows  will tell me te proportion that is compliant.

```{r}
distinct_station_df = station_df %>%
  distinct(line, station_name, .keep_all = TRUE)

n_stations = nrow(distinct_station_df)

sum(distinct_station_df$ada) / n_stations

```

There are 465 distinct stations and 18 percent of the stations are ADA compliant.  

##A Train 

```{r}
distinct_atrain_station_df = distinct_station_df %>%
  gather(key = route_number, value = route_name, route1:route11) %>%
  separate(route_number, sep = "route", into = c("remove1", "route")) %>%
  select(-remove1) %>%
  filter(route_name == "A")

distinct_atrain_ada_station_df = distinct_atrain_station_df %>%
  filter(ada == TRUE)

```


`r nrow(distinct_atrain_station_df)` stations serve the A train and `r nrow(distinct_atrain_ada_station_df)` of these stations are ada compliant

#Problem 2 

##Clean Mr. Trash

Along with rounding the number of sports balls to integers and filtering out totals, I will fill in the missing years by extracting the year from the date. 

```{r}
library(cellranger)
library(readxl)
library(lubridate)


mr_trash_df = read_excel("./Data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", skip = 1, sheet = 1, range = "A2:N256") %>%
  janitor::clean_names() %>%
  filter(!is.na(dumpster)) %>%
  mutate(sports_balls = round(sports_balls, digits = 0)) %>%
  mutate(sports_balls = as.integer(sports_balls)) %>%
  mutate(year = ifelse(!is.na(year), year, year(date)))
  

  

```




##Read in Precipitation


```{r}

precipitation_2017_df = read_excel("./Data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", skip = 1, sheet = 3, range = "A2:B10") %>%
  janitor::clean_names() %>%
  mutate(year = 2017)


precipitation_2016_df = read_excel("./Data/HealthyHarborWaterWheelTotals2017-9-26.xlsx", skip = 1, sheet = 4, range = "A2:B14") %>%
  janitor::clean_names() %>%
  mutate( year = 2016)

precipitation_combined_df = bind_rows(precipitation_2017_df, precipitation_2016_df) %>%
  mutate(month = month.name[month])
  

```



I am filtering by year to get the maximum rainfall by year so I can report the months and the totals. 

```{r}

max_months_df = precipitation_combined_df %>%
  group_by(year) %>%
  filter(total == max(total)) %>%
  ungroup()

  


```


I am creating dataframes so I can report median number of items each year along with months that contain the maximum trash collected

```{r}

mr_trash_2016_df = mr_trash_df %>%
  filter(year == 2016)


mr_trash_2016_totals = mr_trash_df %>%
  filter(year == 2016) %>%
  group_by(month) %>%
  summarise(sum(weight_tons)) %>%
  rename(sum_trash = `sum(weight_tons)`)

```



The precipitation dataset provides data for `r nrow(precipitation_combined_df)` months. The total rainfall in 2016 was `r sum(precipitation_2016_df$total)` and the month with the maximum rainfall in 2016 was `r max_months_df[which(max_months_df$year == 2016), "month"]` with a total of `r max_months_df[which(max_months_df$year == 2016), "total"]` inches of rain. In 2017, the total amount of rain up until August was `r sum(precipitation_2016_df$total)`.  The Mr Trash dataset provides data for `r nrow(mr_trash_df)` dumpsters and for each dumpster provides data for `r ncol(mr_trash_df) -1` variables. The median number of  sports balls in a dumpster in 2016 was `r median(mr_trash_2016_df$sports_balls)` In 2016 the month with the highest trash weight collected was `r mr_trash_2016_totals[which(mr_trash_2016_totals$sum_trash== max(mr_trash_2016_totals$sum_trash)), "month"]` coinciding with the month with the highest rainfall.  


##Problem 3

Formatting the brfss data


```{r}

brfss_2010_df = brfss_smart2010 %>%
  janitor::clean_names() %>%
  rename(proportion = data_value) %>%
  filter(topic == "Overall Health") %>%
  select(-class, -topic, -question, -sample_size, -c(confidence_limit_low:geo_location)) %>%
  spread(key = response, value = proportion) %>%
  janitor::clean_names() %>%
  mutate(excellent_or_very_good = excellent + very_good)



```











